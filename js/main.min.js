var quill,documentList=new Map,currentDocument="welcome";function generateUID(){var e=46656*Math.random()|0,t=46656*Math.random()|0;return(e=("000"+e.toString(36)).slice(-3))+(t=("000"+t.toString(36)).slice(-3))}function dataURItoBlob(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(t.length),i=new Uint8Array(e),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([e],{type:n})}function imageHandler(n,i,e){e.minify({maxWidth:320,maxHeight:320,quality:.7}).then(e=>{var t=e.toBlob(),e=e.toFile("my_cool_image.png");console.log(`type: ${i}`),console.log(`dataUrl: ${n}`),console.log(`blob: ${t}`),console.log(`file: ${e}`)})}function saveHandler(){alert("Save to dropbox!!")}function downloadImageHandler(){quill.setSelection();const e=document.querySelector(".ql-tooltip");e.classList.add("ql-hidden"),html2canvas($("#editor-container")[0]).then(function(e){e=dataURItoBlob(e.toDataURL());saveAs(e,currentDocument+".png")})}function printHandler(){const e=document.querySelector(".ql-tooltip");e.classList.add("ql-hidden"),window.print()}function downloadHandler(){var e=quill.getContents(),e=new window.QuillDeltaToHtmlConverter(e.ops,window.opts_||{}).convert(),e=htmlDocx.asBlob(e);saveAs(e,currentDocument+".docx")}function donationHandler(){window.open("https://www.buymeacoffee.com/yadurajiv")}function aboutHandler(){newDocument(),quill.setContents({ops:[{insert:"Do Writing"},{attributes:{align:"center",header:1},insert:"\n"},{insert:"\nWelcome to dowrite.in a small tool to quickly jot down your ideas in a distraction free space."},{attributes:{align:"center"},insert:"\n\n"},{attributes:{italic:!0},insert:"by"},{attributes:{align:"center"},insert:"\n\n"},{attributes:{link:"https://yadurajiv.com/"},insert:"Yadu Rajiv"},{insert:" ("},{attributes:{link:"https://twitter.com/yadurajiv"},insert:"@yadurajiv"},{insert:")"},{attributes:{align:"center"},insert:"\n\n\n"},{attributes:{bold:!0},insert:{emoji:"fire"}},{attributes:{bold:!0},insert:" [ Tips ] "},{insert:{emoji:"fire"}},{attributes:{align:"center",header:2},insert:"\n"},{attributes:{align:"center"},insert:"\n"},{insert:"Move your mouse up to the top of the screen to access the title bar"},{attributes:{list:"bullet"},insert:"\n"},{insert:"Shift + Click a title to delete it"},{attributes:{list:"bullet"},insert:"\n"},{insert:"Select any text to get more options!"},{attributes:{list:"bullet"},insert:"\n"},{insert:"All docs are stored in the browser's local storage & "},{attributes:{bold:!0},insert:"not online"},{insert:". Remember to back things up."},{attributes:{list:"bullet"},insert:"\n"},{insert:"Select all this text and delete it to start writing or delete this document"},{attributes:{list:"bullet"},insert:"\n"},{insert:"Please reach out to me on twitter if you would like to see more features or bump into bugs!"},{attributes:{list:"bullet"},insert:"\n"},{insert:"You can support me here - "},{attributes:{link:"https://www.buymeacoffee.com/yadurajiv"},insert:"https://www.buymeacoffee.com/yadurajiv"},{attributes:{list:"bullet"},insert:"\n"},{attributes:{align:"center"},insert:"\n"},{attributes:{bold:!0},insert:{emoji:"warning"}},{attributes:{bold:!0},insert:" [ Important Note ] "},{insert:{emoji:"warning"}},{attributes:{align:"center",header:2},insert:"\n"},{insert:"doWrite saves every time a document is modified. These documentsÂ are saved in your browser's local storage. Depending on your browser, this local storage can get deleted when clearing cache or other means. It is a temporary means of storage and hence, please back up your documents as and when needed."},{attributes:{align:"center"},insert:"\n\n"},{insert:"[Updates]"},{attributes:{align:"center",header:2},insert:"\n"},{attributes:{align:"center"},insert:"\n"},{attributes:{italic:!0,bold:!0},insert:"April 24, 2020"},{attributes:{align:"center"},insert:"\n"},{insert:"Initial Release"},{attributes:{align:"center"},insert:"\n"},{insert:"-"},{attributes:{align:"center"},insert:"\n"},{insert:"Current document selected is now highlighted in the title bar"},{attributes:{align:"center"},insert:"\n"},{insert:"Better editing experience in longer documents"},{attributes:{align:"center"},insert:"\n"},{insert:"-"},{attributes:{align:"center"},insert:"\n"},{insert:{emoji:"heart"}},{insert:" Added emoji support - insert using toolbar or type "},{attributes:{bold:!0},insert:":"},{insert:" and start typing "},{insert:{emoji:"heart"}},{attributes:{align:"center"},insert:"\n"},{insert:"Added important note!"},{attributes:{align:"center"},insert:"\n"},{insert:"Can now download the whole document as an image!"},{attributes:{align:"center"},insert:"\n"},{insert:"-"},{attributes:{align:"center"},insert:"\n"},{insert:"Copy pasted images embed into document properly (for word-docx and image exports)"},{attributes:{align:"center"},insert:"\n"}]})}function newdocHandler(){newDocument()}function killHandler(){deleteDocument(currentDocument)}function switchDocument(e,t){if($(`#doc-${currentDocument}`).removeClass("selected"),$(`#doc-${t}`).addClass("selected"),null==e)return currentDocument=t,void quill.setContents(documentList.get(currentDocument));e.shiftKey?(currentDocument=t,quill.setContents(documentList.get(currentDocument)),deleteDocument(t)):(currentDocument=t,quill.setContents(documentList.get(currentDocument)),quill.update())}function deleteDocument(e){1==confirm("Delete document? '"+e+"'")&&(documentList.delete(e),documentList.size<=0?newDocument():e==currentDocument&&switchDocument(null,documentList.entries().next().value[0]),$("#doc-button-"+e).remove())}function newDocument(){1==documentList.size&&alert("doWrite saves every time a document is modified. These documents are saved in your browser's local storage. Depending on your browser, this local storage can get deleted when clearing cache or by other means. It is a temporary means of storage and hence, please back up your documents as and when needed.");var e=generateUID();documentList.set(e,quill.getContents()),switchDocument(null,e),quill.setText("");var i="";documentList.forEach(function(e,t,n){i+=`<span id="doc-button-${t}" class="doc-button"><button id="doc-${t}" class="doc" onclick="switchDocument(event, '${t}')">${t}</button></span>`}),i+='<span id="doc-button-newdoc" class="doc-button"><button id="newdoc" class="doc" onclick="newDocument()"><i class="fa fa-plus"></i></button></span>',$("#docs").html(i),switchDocument(null,e),localStorage.setItem("doWriteData",JSON.stringify([...documentList]))}$(document).ready(function(){quill=new Quill("#editor",{modules:{toolbar:{container:"#toolbar",handlers:{save:saveHandler,print:printHandler,download:downloadHandler,donate:donationHandler,about:aboutHandler,newdoc:newdocHandler,kill:killHandler,dlimg:downloadImageHandler}},imageResize:{displaySize:!0},imageDropAndPaste:{},"emoji-toolbar":!0,"emoji-shortname":!0,"emoji-textarea":!0},placeholder:"Do some awesome writing.",theme:"bubble"});quill.on("text-change",function(e,t,n){documentList.set(currentDocument,quill.getContents()),localStorage.setItem("doWriteData",JSON.stringify([...documentList]));var i=quill.root.ownerDocument.getSelection().baseNode;null!=i&&(i=function(e){for(var t=0,n=0;t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;);return{top:t,left:n}}(3==i.nodeType?i.parentElement:i),window.scroll({top:i.top-300,left:0,behavior:"smooth"}))});var o=QuillImageDropAndPaste.ImageData;quill.getModule("toolbar").addHandler("image",function(e){var i;e&&(null==(i=this.container.querySelector("input.ql-image[type=file]"))&&((i=document.createElement("input")).setAttribute("type","file"),i.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),i.classList.add("ql-image"),i.addEventListener("change",function(e){var t,n=e.target.files;0<n.length&&(t=(e=n[0]).type,(n=new FileReader).onload=e=>{e=e.target.result;imageHandler(e,t,new o(e,t)),i.value=""},n.readAsDataURL(e))})),i.click())}),$("#toolbar").css("display","block");var i,e=localStorage.getItem("doWriteData");null==e?aboutHandler():(documentList=new Map(JSON.parse(e)),i="",documentList.forEach(function(e,t,n){i+=`<span id="doc-button-${t}" class="doc-button"><button id="doc-${t}" class="doc" onclick="switchDocument(event, '${t}')">${t}</button></span>`}),i+='<span id="doc-button-newdoc" class="doc-button"><button id="newdoc" class="doc" onclick="newDocument()"><i class="fa fa-plus"></i></button></span>',$("#docs").html(i),switchDocument(null,documentList.entries().next().value[0]))});